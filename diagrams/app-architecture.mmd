flowchart LR

    subgraph Client
        Browser[User Browser]
    end

    subgraph Proxy["Nginx Reverse Proxy (HTTPS)"]
        Nginx[Nginx]
    end

    subgraph Frontend
        UI[Streamlit Frontend]
    end

    subgraph Backend
        API[FastAPI Backend]
        RAGStub[RAG Stub Logic]
    end

    subgraph VectorDB
        Chroma[(Chroma Vector DB)]
    end

    subgraph Infra["Deployed via ccore-ai-infra"]
        DockerCompose[Docker Compose Stack]
        EC2[(EC2 Instance)]
    end

    %% Public traffic
    Browser -->|HTTPS| Nginx
    Nginx -->|"HTTP (internal)"| UI

    %% Internal traffic
    UI -->|HTTP API Calls| API
    API -->|Query| RAGStub
    RAGStub -->|Lookup| Chroma

    %% Compose orchestrates everything
    DockerCompose --> UI
    DockerCompose --> API
    DockerCompose --> Chroma
    DockerCompose --> Nginx

    EC2 --> DockerCompose
